# üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è: –û–¥–∏–Ω –º–∞–≥–∞–∑–∏–Ω –Ω–∞ –≤–µ–Ω–¥–æ—Ä–∞

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å?

**–ë—ã–ª–æ:** –û–¥–∏–Ω –≤–µ–Ω–¥–æ—Ä –º–æ–≥ –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∞–≥–∞–∑–∏–Ω–æ–≤  
**–°—Ç–∞–ª–æ:** –û–¥–∏–Ω –≤–µ–Ω–¥–æ—Ä = –æ–¥–∏–Ω –º–∞–≥–∞–∑–∏–Ω (one-to-one relationship)

---

## ‚úÖ –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

### 1. Database Schema ‚úÖ
- `merchantId` –∏–º–µ–µ—Ç `@unique` constraint
- –û–¥–∏–Ω –≤–µ–Ω–¥–æ—Ä –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω Store
- –û—Ç–Ω–æ—à–µ–Ω–∏–µ `User.store Store?` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –æ–¥–∏–Ω)

### 2. Backend API ‚úÖ
- **Upsert –ª–æ–≥–∏–∫–∞** - —Å–æ–∑–¥–∞–µ—Ç –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–∞–≥–∞–∑–∏–Ω
- **Prisma –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é –ë–î –≤–º–µ—Å—Ç–æ mock –¥–∞–Ω–Ω—ã—Ö
- **–ù–æ–≤—ã–π endpoint** - `/api/stores/vendor/:merchantId` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### 3. Frontend ‚úÖ
- **VendorOnboarding** - –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ –¥–ª—è –Ω–æ–≤—ã—Ö –≤–µ–Ω–¥–æ—Ä–æ–≤
- **Dashboard –ø—Ä–æ–≤–µ—Ä–∫–∞** - –µ—Å–ª–∏ —É –≤–µ–Ω–¥–æ—Ä–∞ –Ω–µ—Ç –º–∞–≥–∞–∑–∏–Ω–∞ ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–Ω–±–æ—Ä–¥–∏–Ω–≥
- **StoreSettings** - —É–∂–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "One Store Per Vendor" –∏–Ω—Ñ–æ

### 4. –ú–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç ‚úÖ
- –£–¥–∞–ª—è–µ—Ç –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –º–∞–≥–∞–∑–∏–Ω—ã
- –û—Å—Ç–∞–≤–ª—è–µ—Ç —Å–∞–º—ã–π –Ω–æ–≤—ã–π –º–∞–≥–∞–∑–∏–Ω –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–µ–Ω–¥–æ—Ä–∞

---

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é:

### –®–∞–≥ 1: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å Prisma Client
```bash
cd server
npx prisma generate
```

### –®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω –ë–î:

```bash
cd server
npx prisma migrate dev --name one_store_per_vendor
```

–ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –≤ –ø—Ä–æ–¥–∞–∫—à–Ω:
```bash
npx prisma migrate deploy
```

### –®–∞–≥ 3: –û—á–∏—Å—Ç–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –º–∞–≥–∞–∑–∏–Ω—ã
**–í–ê–ñ–ù–û:** –í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ **–ü–û–°–õ–ï** –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ö–µ–º—ã!

```bash
cd server
npx tsx scripts/clean-duplicate-stores.ts
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
- –ù–∞–π–¥–µ—Ç –≤—Å–µ—Ö –≤–µ–Ω–¥–æ—Ä–æ–≤ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –º–∞–≥–∞–∑–∏–Ω–∞–º–∏
- –û—Å—Ç–∞–≤–∏—Ç —Å–∞–º—ã–π –Ω–æ–≤—ã–π –º–∞–≥–∞–∑–∏–Ω
- –£–¥–∞–ª–∏—Ç —Å—Ç–∞—Ä—ã–µ –º–∞–≥–∞–∑–∏–Ω—ã

### –®–∞–≥ 4: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
```bash
cd server
npm run dev
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

### 1. –ù–æ–≤—ã–π –≤–µ–Ω–¥–æ—Ä (–±–µ–∑ –º–∞–≥–∞–∑–∏–Ω–∞)
```
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∫–∞–∫ MERCHANT
2. –û—Ç–∫—Ä–æ–π—Ç–µ /merchant
3. –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å—Å—è VendorOnboarding
4. –ù–∞–∂–º–∏—Ç–µ "–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–∞–≥–∞–∑–∏–Ω"
5. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ Store Settings
6. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ
7. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ Dashboard - –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
```

### 2. –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –≤–µ–Ω–¥–æ—Ä (—Å –º–∞–≥–∞–∑–∏–Ω–æ–º)
```
1. –û—Ç–∫—Ä–æ–π—Ç–µ /merchant
2. –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å—Å—è –æ–±—ã—á–Ω—ã–π Dashboard
3. –ó–∞–π–¥–∏—Ç–µ –≤ Store Settings
4. –ò–∑–º–µ–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ - –¥–æ–ª–∂–µ–Ω –û–ë–ù–û–í–ò–¢–¨ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–∞–≥–∞–∑–∏–Ω (–Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π)
```

### 3. API —Ç–µ—Å—Ç—ã
```bash
# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –º–∞–≥–∞–∑–∏–Ω—ã
curl http://localhost:5000/api/stores

# –ü–æ–ª—É—á–∏—Ç—å –º–∞–≥–∞–∑–∏–Ω –≤–µ–Ω–¥–æ—Ä–∞
curl http://localhost:5000/api/stores/vendor/MERCHANT_ID

# –°–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å –º–∞–≥–∞–∑–∏–Ω
curl -X POST http://localhost:5000/api/stores \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Test Bakery",
    "address": "Bishkek, Chuy 123",
    "latitude": 42.8746,
    "longitude": 74.5698,
    "phone": "+996555123456",
    "merchantId": "MERCHANT_ID"
  }'
```

---

## üö® –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ —É –≤–µ–Ω–¥–æ—Ä–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–æ—á–µ–∫?

### –í–∞—Ä–∏–∞–Ω—Ç 1: –†–∞–∑–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è MVP)
```
–¢–æ—á–∫–∞ 1 ‚Üí Telegram –∞–∫–∫–∞—É–Ω—Ç A ‚Üí Merchant 1
–¢–æ—á–∫–∞ 2 ‚Üí Telegram –∞–∫–∫–∞—É–Ω—Ç B ‚Üí Merchant 2
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É–¥—É—â–µ–º (v2.0)
–ï—Å–ª–∏ –≤ –±—É–¥—É—â–µ–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è:
1. –£–±—Ä–∞—Ç—å `@unique` —Å `merchantId`
2. –ò–∑–º–µ–Ω–∏—Ç—å `store Store?` –Ω–∞ `stores Store[]`
3. –î–æ–±–∞–≤–∏—Ç—å UI –¥–ª—è –≤—ã–±–æ—Ä–∞ –º–∞–≥–∞–∑–∏–Ω–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ—Ñ—Ñ–µ—Ä–∞
4. –û–±–Ω–æ–≤–∏—Ç—å Dashboard –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Å–µ—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤

---

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ One-to-One:

| –ê—Å–ø–µ–∫—Ç | One-to-One | One-to-Many |
|--------|------------|-------------|
| –ü—Ä–æ—Å—Ç–æ—Ç–∞ UX | ‚úÖ –û—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ–π | ‚ö†Ô∏è –ù—É–∂–µ–Ω –≤—ã–±–æ—Ä –º–∞–≥–∞–∑–∏–Ω–∞ |
| –ö–æ–¥ | ‚úÖ –ú–µ–Ω—å—à–µ –ª–æ–≥–∏–∫–∏ | ‚ùå –ë–æ–ª—å—à–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ |
| –î–ª—è MVP | ‚úÖ –ò–¥–µ–∞–ª—å–Ω–æ | ‚ùå Overkill |
| –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å | ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ | ‚úÖ –ì–∏–±–∫–∞—è |

–î–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ MVP **one-to-one –∏–¥–µ–∞–ª–µ–Ω**.

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:

### –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —É –∫–∞–∂–¥–æ–≥–æ –≤–µ–Ω–¥–æ—Ä–∞ –º–∞–∫—Å–∏–º—É–º 1 –º–∞–≥–∞–∑–∏–Ω
SELECT merchant_id, COUNT(*) as store_count
FROM stores
GROUP BY merchant_id
HAVING COUNT(*) > 1;

-- –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É—Å—Ç—ã–º!
```

### –í –∫–æ–¥–µ:
```typescript
// –í StoreSettings –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
await storesApi.create(storeData);

// Prisma –∏—Å–ø–æ–ª—å–∑—É–µ—Ç UPSERT:
prisma.store.upsert({
  where: { merchantId }, // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á
  create: {...},
  update: {...}
})
```

---

## ‚ùì FAQ:

**Q: –ß—Ç–æ –µ—Å–ª–∏ –≤–µ–Ω–¥–æ—Ä —Å–ª—É—á–∞–π–Ω–æ —É–¥–∞–ª–∏—Ç —Å–≤–æ–π –º–∞–≥–∞–∑–∏–Ω?**  
A: –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —á–µ—Ä–µ–∑ Store Settings

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –∞–¥—Ä–µ—Å –º–∞–≥–∞–∑–∏–Ω–∞?**  
A: –î–∞, –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç–µ –≤ Store Settings

**Q: –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –æ—Ñ—Ñ–µ—Ä–∞–º–∏ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –º–∞–≥–∞–∑–∏–Ω–∞?**  
A: Cascade delete - –≤—Å–µ –æ—Ñ—Ñ–µ—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è

**Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –≤—Ç–æ—Ä–æ–π –º–∞–≥–∞–∑–∏–Ω?**  
A: –°–æ–∑–¥–∞–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π Telegram –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è –≤—Ç–æ—Ä–æ–π —Ç–æ—á–∫–∏

---

## üéØ –ò—Ç–æ–≥:

‚úÖ –û–¥–∏–Ω –≤–µ–Ω–¥–æ—Ä = –æ–¥–∏–Ω –º–∞–≥–∞–∑–∏–Ω  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ –¥–ª—è –Ω–æ–≤—ã—Ö –≤–µ–Ω–¥–æ—Ä–æ–≤  
‚úÖ Upsert –ª–æ–≥–∏–∫–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã  
‚úÖ –°–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –¥—É–±–ª–µ–π  

**–ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é!** üöÄ
