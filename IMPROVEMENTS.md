# –£–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –≤ –∫–æ–¥–µ

#### CORS Configuration
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π CORS —Å —É—á–µ—Ç–æ–º production/development –æ–∫—Ä—É–∂–µ–Ω–∏–π
- ‚úÖ –í production —Ä–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ origins
- ‚úÖ –í development —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –≤—Å–µ origins –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–§–∞–π–ª**: `server/src/index.ts`

#### –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ Prisma –æ—à–∏–±–æ–∫ (P2002, P2025)
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –≤ development —Ä–µ–∂–∏–º–µ

**–§–∞–π–ª**: `server/src/index.ts`

### 2. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (Zod)

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ Zod –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã —Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è:
  - Stores (`storeSchema`)
  - Offers (`offerSchema`)
  - Orders (`orderSchema`)
  - Auth (`authSchema`, `vendorRegisterSchema`)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –∫ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞–º:
  - `stores.controller.ts` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –º–∞–≥–∞–∑–∏–Ω–∞
  - `offers.controller.ts` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ—Ñ—Ñ–µ—Ä–∞
  - `orders.controller.ts` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞

**–§–∞–π–ª—ã**:
- `server/src/utils/validation.ts` - —Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### 3. –û–Ω–±–æ—Ä–¥–∏–Ω–≥ –¥–ª—è –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π

- ‚úÖ –°–æ–∑–¥–∞–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `BuyerOnboarding.tsx`
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ `Home.tsx` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —á–µ—Ä–µ–∑ localStorage
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ä–æ—É—Ç `/onboarding` –≤ `App.tsx`
- ‚úÖ –ö—Ä–∞—Å–∏–≤—ã–π UI —Å –ø–æ—à–∞–≥–æ–≤—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage)

**–§–∞–π–ª—ã**:
- `src/features/shared/BuyerOnboarding.tsx` - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞
- `src/features/buyer/Home.tsx` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞
- `src/App.tsx` - –¥–æ–±–∞–≤–ª–µ–Ω —Ä–æ—É—Ç

### 4. –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞–≥–∞–∑–∏–Ω–∞–º–∏

#### –°–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- ‚úÖ `clean-duplicate-stores.ts` - —É–¥–∞–ª—è–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã, –æ—Å—Ç–∞–≤–ª—è—è –ø–æ –æ–¥–Ω–æ–º—É –º–∞–≥–∞–∑–∏–Ω—É –Ω–∞ –≤–µ–Ω–¥–æ—Ä–∞
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–∞–º—ã–π –Ω–æ–≤—ã–π –º–∞–≥–∞–∑–∏–Ω –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–µ–Ω–¥–æ—Ä–∞
- ‚úÖ –í—ã–≤–æ–¥–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

#### –°–∫—Ä–∏–ø—Ç —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤ –∫—Ä–æ–º–µ –æ–¥–Ω–æ–≥–æ
- ‚úÖ `delete-all-stores-except-one.ts` - —É–¥–∞–ª—è–µ—Ç –í–°–ï –º–∞–≥–∞–∑–∏–Ω—ã, –æ—Å—Ç–∞–≤–ª—è—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω (—Å–∞–º—ã–π –Ω–æ–≤—ã–π)
- ‚úÖ –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è/—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –£–¥–∞–ª—è–µ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –º–∞–≥–∞–∑–∏–Ω–æ–≤!

**–§–∞–π–ª—ã**:
- `server/scripts/clean-duplicate-stores.ts`
- `server/scripts/delete-all-stores-except-one.ts`

### 5. –õ–æ–≥–∏–∫–∞ –æ–¥–Ω–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞ –Ω–∞ –≤–µ–Ω–¥–æ—Ä–∞

- ‚úÖ –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ Prisma unique constraint (`merchantId @unique`)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è UPSERT –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –û–Ω–±–æ—Ä–¥–∏–Ω–≥ –¥–ª—è –≤–µ–Ω–¥–æ—Ä–æ–≤ –±–µ–∑ –º–∞–≥–∞–∑–∏–Ω–∞

**–§–∞–π–ª—ã**:
- `server/prisma/schema.prisma` - unique constraint
- `server/src/controllers/stores.controller.ts` - UPSERT –ª–æ–≥–∏–∫–∞
- `src/features/merchant/Dashboard.tsx` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –º–∞–≥–∞–∑–∏–Ω–∞

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–æ–≤ –æ—á–∏—Å—Ç–∫–∏

#### –û—á–∏—Å—Ç–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ –≤–µ–Ω–¥–æ—Ä–∞):
```bash
cd server
npx tsx scripts/clean-duplicate-stores.ts
```

#### –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤ –∫—Ä–æ–º–µ –æ–¥–Ω–æ–≥–æ:
```bash
cd server
npx tsx scripts/delete-all-stores-except-one.ts
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞

1. **–î–ª—è –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π**: –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ–Ω–±–æ—Ä–¥–∏–Ω–≥
2. **–î–ª—è –≤–µ–Ω–¥–æ—Ä–æ–≤**: –ü—Ä–∏ –≤—Ö–æ–¥–µ –≤ `/merchant` –±–µ–∑ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ–Ω–±–æ—Ä–¥–∏–Ω–≥

### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏:
- –°–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –º–∞–≥–∞–∑–∏–Ω–∞
- –°–æ–∑–¥–∞–Ω–∏–∏ –æ—Ñ—Ñ–µ—Ä–∞
- –°–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞

–ü—Ä–∏ –æ—à–∏–±–∫–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø–æ–ª–µ–π.

---

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

### –î–ª—è production:

1. **Environment Variables**:
   - –î–æ–±–∞–≤–∏—Ç—å `ALLOWED_ORIGINS` –≤ `.env` –¥–ª—è CORS
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ `.env.example`

2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Winston –∏–ª–∏ Pino –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ª–æ–≥–æ–≤
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (info, warn, error)

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**:
   - –î–æ–±–∞–≤–∏—Ç—å Sentry –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å health checks

4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —á–∞—Å—Ç–µ–π
   - E2E —Ç–µ—Å—Ç—ã –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ–ª–æ—É

5. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**:
   - Rate limiting –¥–ª—è API
   - Helmet.js –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ headers
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö (—É–∂–µ —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

---

## üéØ –ò—Ç–æ–≥–∏

- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å CORS –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Zod
- ‚úÖ –°–æ–∑–¥–∞–Ω –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ –¥–ª—è –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞–≥–∞–∑–∏–Ω–∞–º–∏
- ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ª–æ–≥–∏–∫–∏ –æ–¥–Ω–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞ –Ω–∞ –≤–µ–Ω–¥–æ—Ä–∞

–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ —É–ª—É—á—à–µ–Ω–∏—è–º! üöÄ
